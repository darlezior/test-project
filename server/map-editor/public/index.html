<!DOCTYPE html>
<html>
<head>
  <title>Map Editor Test</title>
  <style>
    body { font-family: sans-serif; }
    input, button { margin: 4px; }
  </style>
</head>
<body>
  <h1>Map Items Editor</h1>

  <label>Map name: <input id="mapName" value="defaultMap"></label>
  <button onclick="loadItems()">Load Items</button>
  <hr>

  <div id="itemsList"></div>

  <h2>Add New Item</h2>
  <form id="addForm" onsubmit="addItem(event)">
    <input placeholder="x" name="x" type="number" required>
    <input placeholder="y" name="y" type="number" required>
    <input placeholder="type" name="type" required>
    <button type="submit">Add Item</button>
  </form>

  <script>
    async function loadItems() {
      const map = document.getElementById('mapName').value;
      const res = await fetch('/map-editor/' + map);
      const items = await res.json();
      const listDiv = document.getElementById('itemsList');
      listDiv.innerHTML = '';
      items.forEach(i => {
        const div = document.createElement('div');
        div.textContent = `ID: ${i._id} | x: ${i.x}, y: ${i.y}, type: ${i.type}`;
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = async () => {
          await fetch('/map-editor/' + i._id, { method: 'DELETE' });
          loadItems();
        };
        div.appendChild(delBtn);
        listDiv.appendChild(div);
      });
    }

    async function addItem(e) {
      e.preventDefault();
      const form = e.target;
      const map = document.getElementById('mapName').value;
      const data = {
        map,
        x: Number(form.x.value),
        y: Number(form.y.value),
        type: form.type.value,
        properties: {}
      };
      await fetch('/map-editor', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      form.reset();
      loadItems();
    }
  </script>
</body>
</html>
